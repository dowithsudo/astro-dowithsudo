---
import Base from "@/layouts/Base.astro";
import { getCollection, render } from "astro:content";

// 1. Ambil data dengan proteksi
const pages = await getCollection("pages");
const entry = pages.find((p: any) => p.id === "id/about.md" || p.id === "id/about");

if (!entry) {
  throw new Error("Konten id/about.md tidak ditemukan!");
}

// 2. Render konten
const rendered = await render(entry);
const Content = rendered.Content;
const headings = rendered.headings;

const { title, description, meta_title } = entry.data;
---

<Base title={title} meta_title={meta_title} description={description}>
  <section class="section-sm">
    <div class="container">
      <div class="row justify-start">
        
        <div class="lg:col-8 md:col-8">
          
          <header class="flex flex-col md:flex-row items-center gap-8 mb-10 border-b pb-10 dark:border-darkmode-border text-left">
            <div class="relative">
              <img 
                src="/images/avatar.png" 
                alt="Kamandanu Tresna Wijaya" 
                class="w-32 h-32 md:w-36 md:h-36 rounded-full object-cover border-4 border-primary/10 p-1 shadow-md"
              />
            </div>

            <div class="text-center md:text-left">
              <h1 class="text-3xl md:text-4xl font-bold text-dark dark:text-darkmode-light mb-1 tracking-tight">
                Kamandanu Tresna Wijaya
              </h1>
              <p class="text-lg md:text-xl font-medium text-primary mb-3">
                IT Infrastructure & Network Administrator
              </p>
              
              <div class="flex flex-wrap justify-center md:justify-start items-center gap-3 text-[13px] text-gray-500 dark:text-gray-400">
                <span class="flex items-center gap-1.5">
                  <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 10c0 7-9 13-9 13s-9-6-9-13a9 9 0 0 1 18 0z"></path><circle cx="12" cy="10" r="3"></circle></svg>
                  Indonesia
                </span>
                <span class="text-gray-300 hidden md:block">â€¢</span>
                <span class="flex items-center gap-2 px-3 py-1 bg-green-50 dark:bg-green-900/10 text-green-600 dark:text-green-400 rounded-full border border-green-100 dark:border-green-800/30 font-medium shadow-sm">
                  <span class="relative flex h-2 w-2">
                    <span class="animate-ping absolute inline-flex h-full w-full rounded-full bg-green-400 opacity-75"></span>
                    <span class="relative inline-flex rounded-full h-2 w-2 bg-green-500"></span>
                  </span>
                  Open to work & project
                </span>
              </div>
            </div>
          </header>

          <article class="content-cv prose prose-xl max-w-none dark:prose-invert leading-relaxed text-left">
            <Content />
          </article>
        </div>

        <div class="lg:col-4 md:col-4 hidden md:block">
          <aside class="sticky top-24 pl-10">
            <div class="bg-theme-light dark:bg-darkmode-theme-light p-6 rounded-lg border border-border dark:border-darkmode-border">
              <h4 class="h5 mb-4 border-b pb-2 text-left">Daftar Isi</h4>
              <nav>
                <ul class="space-y-3 text-sm font-medium text-left list-none p-0 m-0">
                  {headings.map((h: any) => (
                    h.depth <= 3 && (
                      <li class="list-none ml-0 p-0">
                        <a 
                          href={`#${h.slug}`} 
                          class="hover:text-primary block py-1 border-l-2 border-transparent hover:border-primary pl-2 transition-all no-underline text-gray-600 dark:text-gray-400"
                        >
                          {h.text}
                        </a>
                      </li>
                    )
                  ))}
                </ul>
              </nav>
            </div>
          </aside>
        </div>

      </div>
    </div>
  </section>
</Base>

<style is:global>
  /* Fix teks profil agar lebih menonjol */
  .content-cv p {
    font-size: 1.15rem !important; /* Ukuran teks isi lebih besar sedikit */
    color: #374151; /* gray-700 */
  }
  .dark .content-cv p {
    color: #d1d5db; /* gray-300 */
  }

  /* Mengecilkan judul PT (h4) agar tidak terlalu besar */
  .content-cv h4 {
    font-size: 1.25rem !important; 
    font-weight: 700 !important;
    margin-top: 1.5rem !important;
    margin-bottom: 0.5rem !important;
    color: #111827 !important;
  }
  .dark .content-cv h4 {
    color: #f3f4f6 !important;
  }

  /* Style tambahan untuk list */
  .content-cv ul {
    list-style-type: disc !important;
    padding-left: 1.5rem !important;
    font-size: 1.1rem !important;
  }
  
  .content-cv h2, .content-cv h3 {
    scroll-margin-top: 100px;
    text-align: left !important;
  }
  html {
    scroll-behavior: smooth;
  }
</style>